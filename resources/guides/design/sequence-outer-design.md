# 외부 시퀀스 설계 가이드

## 목적

유저스토리의 핵심 비즈니스 플로우를 기반으로, 프론트엔드부터 백엔드 서비스·인프라·외부 시스템까지의 End-to-End 호출 흐름을 외부 시퀀스 다이어그램으로 설계함.

## 입력 (이전 단계 산출물)

| 산출물 | 파일 경로 | 활용 방법 |
|--------|----------|----------|
| 유저스토리 | `docs/plan/design/userstory.md` | 핵심 비즈니스 플로우 도출 |
| 논리 아키텍처 | `docs/design/logical-architecture.md` | 서비스 참여자 확인 |
| UI/UX 설계서 | `docs/plan/design/uiux/uiux.md` | 사용자 인터랙션 파악 |

## 출력 (이 단계 산출물)

| 산출물 | 파일 경로 |
|--------|----------|
| 외부 시퀀스 다이어그램 | `docs/design/sequence/outer/{플로우명}.puml` |

## 방법론

### 작성 원칙

- **유저스토리와 매칭**되어야 함. **불필요한 추가 설계 금지**
- **논리 아키텍처에 정의한 참여자와 일치**해야 함
- UI/UX 설계서의 '사용자 플로우' 참조하여 설계
- **해당 플로우에 참여하는** 프론트엔드, 모든 서비스, 인프라 컴포넌트(예: Gateway, Message Queue, Database), 외부 시스템을 참여자로 추가
- 플로우에 참여자들의 역할과 책임을 명확히 표시
- 플로우 수행에 필요한 프론트엔드부터 End-to-End 호출을 순서대로 표시하고 한글 설명 추가
- 마이크로서비스 내부의 처리 흐름은 표시하지 않음
- 동기/비동기 통신 구분 (실선/점선)
- 캐시, 큐 등 인프라 컴포넌트와의 상호작용 포함

### 작성 순서

- 준비:
  - 유저스토리, UI/UX 설계서, 논리 아키텍처 분석 및 이해
  - `@analyze --play` 프로토타입이 있는 경우 웹브라우저에서 실행하여 서비스 이해
- 실행:
  - 핵심 비즈니스 플로우별로 파일을 분리하여 작성
    - 병렬 수행 가이드에 따라 병렬 수행
    - **PlantUML 스크립트 파일 생성 즉시 검사 실행**: 'PlantUML 문법 검사 가이드' 준용
- 검토:
  - 작성 원칙 준수 검토
  - 스쿼드 팀원 리뷰: 누락 및 개선 사항 검토
  - 수정 사항 선택 및 반영

### 병렬 수행

- **서브 에이전트를 활용한 병렬 작성 필수**
- 서비스별 독립적인 에이전트가 각 외부 시퀀스 설계를 동시에 작업
- 모든 설계 완료 후 전체 검증

## 출력 형식

```plantuml
!theme mono

title {플로우명}

actor "사용자" as user
participant "프론트엔드" as fe
participant "{서비스명}" as svc
participant "{인프라}" as infra

user -> fe : {액션 설명}
fe -> svc : {API 호출 설명}
svc --> fe : {응답 설명}
fe --> user : {화면 표시 설명}
```

## 품질 기준

### 완료 체크리스트

- [ ] MVP Must Have 유저스토리 전체 커버
- [ ] `!theme mono` 사용
- [ ] 한국어로 작성
- [ ] PlantUML 문법 검사 통과
- [ ] 마이크로서비스 내부 처리 흐름 미포함
- [ ] 논리 아키텍처에 정의된 참여자와 일치
- [ ] 동기/비동기 통신 구분 표기

## 주의사항

- 유저스토리에 없는 플로우 추가 금지
- 마이크로서비스 내부 처리 흐름은 내부 시퀀스 설계서에서 별도 작성
- 플로우명은 한글로 네이밍
- 참고 예시: https://raw.githubusercontent.com/cna-bootcamp/clauding-guide/refs/heads/main/samples/sample-시퀀스설계서(외부).puml
