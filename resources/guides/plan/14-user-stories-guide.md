# 유저스토리 작성 가이드

## 목적

이벤트 스토밍 결과를 기반으로 체계적인 유저스토리를 작성함.
표준화된 형식을 통해 일관성 있고 완전한 요구사항을 정의함.

## 입력 (이전 단계 산출물)

| 산출물 | 파일 경로 | 활용 방법 |
|--------|----------|----------|
| 이벤트 스토밍 | `docs/plan/think/es/*.puml` | 유저플로우 → Epic, 이벤트 → Story, 커맨드 → Task, 정책 → AC 변환 |
| 핵심 솔루션 | `docs/plan/think/핵심솔루션.md` | 솔루션 범위에 맞는 유저스토리 도출 |
| 고객 분석 | `docs/plan/define/고객분석.md` | 사용자 역할(Persona) 정의에 활용 |
| 유저 저니 맵 | `docs/plan/define/유저저니맵.md` | Pain Points → 유저스토리 추적성 연결 |

## 출력 (이 단계 산출물)

| 산출물 | 파일 경로 |
|--------|----------|
| 유저스토리 | `docs/plan/design/userstory.md` |

## 이벤트스토밍 → 유저스토리 연결

| Event Storming 요소 | User Story 요소 | 설명 |
|-------------------|----------------|------|
| **유저플로우(제목)** | Epic | 주요 비즈니스 기능 단위 |
| **이벤트 [이벤트]** | Story (I want to...) | 사용자가 달성하고 싶은 결과 |
| **커맨드 [커맨드]** | 시나리오/Task | 결과를 달성하기 위한 구체적 행동 |
| **정책/규칙 [정책/규칙]** | Acceptance Criteria | 비즈니스 규칙 및 제약사항 |
| **데이터 [데이터]** | 입력/출력 요구사항 | 필요한 데이터 정의 |
| **참여자 (Actor)** | Persona (As a...) | 스토리의 주체 |

> **핵심 원칙**: 사용자는 "버튼을 클릭하고 싶은 것"이 아니라 "결과를 달성하고 싶은 것"임.

## Pain Point 추적성

### UFR-Pain Point 연결
각 UFR 작성 시 관련 Pain Point를 태그로 연결하여 "왜 이 기능이 필요한가?"에 대한 근거를 명시함.

- UFR 작성 형식에 `Pain Point` 필드 추가: `Pain Point: {여정맵 Pain Point ID}`

### Pain Point 추적 매트릭스

```markdown
| Pain Point (여정맵) | 관련 UFR | 해결 방식 |
|--------------------|---------|---------|
| {Pain Point ID}: {Pain Point 내용} | {UFR-XXX-NNN} | {이 UFR이 해당 Pain Point를 어떻게 해결하는지} |
```

> **원칙**: 여정맵의 모든 Pain Point는 최소 1개 이상의 UFR과 연결되어야 함. 연결되지 않은 Pain Point가 있다면 UFR 추가를 검토할 것.

## 작성 구성 요소

### 1. 서비스
마이크로서비스명을 명시합니다.
- **형식**: 서비스 도메인명
- **예시**: User, Trip, AI, Location

### 2. ID (유저스토리 식별자)

**형식**: `<유저스토리 유형 코드>-<서비스약어>-<일련번호>`

| 유형 코드 | 의미 | 설명 |
|-----------|------|------|
| **UFR** | User Functional Requirements | 사용자 기능 요구사항 |
| **AFR** | Admin Functional Requirements | 어드민 기능 요구사항 |
| **NFR** | Non-Functional Requirements | 비기능 요구사항 (확장성, 회복성, 성능, 보안 등) |

- **서비스약어**: 3~4자로 작성
- **일련번호**: 3자리, 010부터 시작하여 10씩 증가
- **예시**: `UFR-USER-010`, `UFR-TRIP-020`, `AFR-ADMIN-010`, `NFR-SYS-010`

### 3. Epic
유저스토리의 상위 카테고리를 분류합니다.
- **용도**: 관련 유저스토리들을 그룹화
- **예시**: 사용자 인증 및 관리, 여행 관리, AI 일정 생성

### 4. 유저스토리

**형식**: `[유저스토리 제목] <유저유형>으로서 | 나는, <비즈니스 목적>을 위해 | <작업/기능>을(를) 원합니다.`

- **예시**:
  - [회원가입] 사용자로서 | 나는, 여행 계획을 관리하기 위해 | 간편하게 회원가입하고 싶다.
  - [주문현황] 관리자로서 | 나는, 주문 상태를 파악하기 위해 | 실시간 주문 현황 대시보드를 원합니다.

> **유저유형 범위**: 사람뿐 아니라 시스템, API 등도 유저유형으로 정의할 수 있음.
> 이벤트 스토밍은 사용자 중심 수행을 위해 사람만 Actor로 허용하지만,
> 유저스토리는 충분한 요구사항 전달을 위해 사람이 아닌 유저유형도 허용함.

### 5. 인수테스트 시나리오

기능 완성도를 검증하기 위한 테스트 시나리오입니다.

#### 시나리오명
- 테스트할 기능이나 상황을 명확히 표현
- **예시**: "정상적인 회원 가입 처리", "중복 이메일 가입 시도"

#### 인수기준 (Given-When-Then 형식)
- **형식**: `<Given 사전조건/상황> | <When 사용자 액션> | <Then 기대 결과>`
- **예시**:
```
미로그인 상태에서 회원가입 화면에 접근한 상황에서 | 필수 정보를 모두 입력하고 회원가입 버튼을 클릭하면 | 가입이 완료되고 로그인 화면으로 이동한다.
```

#### 체크리스트
세부 테스트 항목을 최대한 자세히 작성합니다.
- 기능/비기능 요구사항 검증 항목
- 예외 상황 처리 검증
- 통합 테스트 항목

### 6. Biz중요도 (MoSCoW 분류)

| 분류 | 의미 | 설명 |
|------|------|------|
| **M (Must)** | 반드시 필요 | 핵심 비즈니스 기능, 없으면 서비스 불가능 |
| **S (Should)** | 매우 필요하나 대체 방법 있음 | 중요하지만 우회 방법이 존재 |
| **C (Could)** | 있으면 좋으나 우선순위 낮음 | 사용자 편의성 향상 기능 |
| **W (Won't)** | 보류 | 향후 개발 고려 기능 |

### 7. Score (구현 난이도)

피보나치 수열을 이용하여 구현 난이도를 표현합니다.

| 점수 | 난이도 | 설명 | 예시 |
|------|--------|------|------|
| **1-2** | 매우 간단 | 기본적인 CRUD 작업, 단일 파일 수정 | README 작성, 환경변수 설정 |
| **3-5** | 간단 | 기본 비즈니스 로직, 여러 파일 수정 | 설정 파일 파싱, 기본 유효성 검사 |
| **8-13** | 보통 | 복잡한 비즈니스 로직, API 연동 | API 서버 연동, CLI 개발 |
| **21-34** | 복잡 | 다중 시스템 연동, 성능 최적화 | 실시간 모니터링, 복잡한 워크플로우 |
| **55+** | 매우 복잡 | 새로운 아키텍처, 연구개발 요소 | AI 모델 통합, 분산 시스템 설계 |

## 상세 요구사항 작성 형식

```markdown
UFR-{서비스}-{번호}: [{제목}] {사용자유형}으로서 | 나는, {목적}을 위해 | {결과}를 원한다.

- 시나리오: {시나리오명}
  {Given 상황} | {When 액션} | {Then 결과}

  [입력 요구사항]
  - 기본 정보
    - {필드명}: {검증 조건}
  - 추가 정보
    - {필드명}: {검증 조건}

  [검증 요구사항]
  - {검증 항목}: {검증 내용}

  [처리 결과]
  - 성공 시
    - {결과 항목}
  - 실패 시
    - {실패 조건}: {처리 방법}

- {M/S/C/W}/{Score}
```

## 출력 형식

코드블록 내에 아래 구조로 작성합니다.
```
{서비스 일련번호}. {서비스명}
{Epic 일련번호}) {Epic}
{유저스토리 ID}: [{유저스토리 제목}] {유저스토리}
- 시나리오: {시나리오명}
  {인수기준}
  - {체크리스트}
- {Biz중요도}/{Score}
```

### 추가 항목
필요 시 '기술 태스크' 등 기술적 내용을 추가할 수 있습니다.
```
- 기술 태스크
  - API 구현
    - POST /api/resource (생성)
    - GET /api/resource/{id} (조회)
  - 외부 연동
    - 외부 API 통합
```

## 마이크로서비스 구성 예시
- **User Service**: 사용자 관리 (회원가입, 로그인, 프로필)
- **[Core] Service**: 핵심 비즈니스 기능
- **[AI] Service**: AI 기반 기능
- **[Integration] Service**: 외부 연동 기능

## Feature Story Map

```
User Service
├── UFR-USER-010: 회원가입
├── UFR-USER-020: 로그인
└── UFR-USER-030: 프로필 관리

Core Service
├── UFR-CORE-010: {기능 1}
└── UFR-CORE-020: {기능 2}
```

## 우선순위 매트릭스

- **Must Have (P0)**: 필수 기능
- **Should Have (P1)**: 중요 기능
- **Could Have (P2)**: 선택 기능
- **Won't Have**: 향후 고려

## 스프린트 계획 (MVP 기준)

```markdown
### Sprint N (N-N주차)
**Sprint 목표**: {핵심 목표}
- [ ] UFR-USER-010: {제목} (M/5)
- [ ] UFR-CORE-020: {제목} (M/3)
**총 Story Points**: {합계}
```

## 비기능적 요구사항

### 성능
- 페이지 로드: 3G에서 <3초, WiFi에서 <1초
- API 응답: <200ms
- 동시 사용자: 1000명

### 보안
- HTTPS 적용, 인증/권한 관리, 데이터 암호화

### 사용성
- 모바일 반응형, WCAG 2.1 접근성 준수

### 확장성
- 수평 확장, 클라우드 네이티브, 마이크로서비스 아키텍처

## Definition of Done 체크리스트

- [ ] 코드 리뷰 완료
- [ ] 단위 테스트 작성 및 통과
- [ ] 통합 테스트 통과
- [ ] 문서화 완료
- [ ] QA 테스트 통과
- [ ] 스테이징 배포 및 검증

## INVEST 원칙

- **I**ndependent: 독립적으로 개발 가능
- **N**egotiable: 세부사항 논의 가능
- **V**aluable: 사용자에게 가치 제공
- **E**stimable: 추정 가능
- **S**mall: 한 스프린트 내 완료 가능
- **T**estable: 명확한 인수 기준

## 샘플

작성 시 아래 샘플을 참고하세요.

- `resources/samples/sample-유저스토리.md`

## 품질 기준

### 완료 체크리스트
- [ ] UFR 20개 이상 작성
- [ ] UFR/AFR/NFR 포맷 준수 (`{유형코드}-{서비스약어}-{일련번호}`)
- [ ] 모든 UFR에 시나리오(Given-When-Then) 포함
- [ ] MoSCoW 분류(M/S/C/W) 전체 UFR에 적용
- [ ] Story Points(피보나치) 전체 UFR에 적용
- [ ] INVEST 원칙 준수 확인
- [ ] Feature Story Map 작성
- [ ] 우선순위 매트릭스 (Must/Should/Could/Won't) 작성
- [ ] 스프린트 계획 (MVP 기준) 작성
- [ ] 비기능적 요구사항 (성능/보안/사용성/확장성) 포함
- [ ] Definition of Done 체크리스트 포함
- [ ] Pain Point 추적 매트릭스 작성 (여정맵 Pain Point ↔ UFR 매핑)
- [ ] 이벤트 스토밍 결과와 체계적 연계 확인 (유저플로우→Epic, 이벤트→Story)
- [ ] 이전 단계 산출물(핵심솔루션, 고객분석, 유저저니맵)과 일관성 확인

### 정량 기준
- UFR: 20개 이상
- 마이크로서비스: 2개 이상
- 스프린트: MVP 기준 계획 포함
- Pain Point 추적률: 여정맵 Pain Point의 100% UFR 연결

## 주의사항

- UFR/AFR/NFR 포맷 준수: `{유형코드}-{서비스약어}-{일련번호}`
- 최소 20개 이상 UFR
- 시나리오는 Given-When-Then 형식 필수
- 체크리스트를 최대한 자세히 작성
- Event Storming 결과와 체계적 연계
- 마이크로서비스 구조로 명확히 그룹화
- 비기능적 요구사항 필수 포함
- 명확성: 모호한 표현 대신 구체적이고 측정 가능한 표현 사용
- 완전성: 모든 필수 구성 요소를 빠짐없이 작성
- 추적성: ID를 통해 설계 문서와 연결 가능하도록 작성
- 테스트 가능성: 인수테스트 시나리오가 실제 테스트로 실행 가능하도록 구체적으로 작성
